<?php

$isbnlist = array(
  9784313150744,
  9784313150768,
  9784313150775,
  9784313150782,
  9784313165809,
  9784313651999,
  9784313652101,
  9784313652286,
  9784313652309,
  9784313652354,
  9784313652361,
  9784313652422,
  9784313660359,
  9784313660366,
  9784313660397,
  9784313660557,
  9784313720480,
  9784313750098,
  9784313750104,
  9784313750319,
  9784313750326,
  9784313750883,
  9784313751415,
  9784313751422,
  9784313751637,
  9784313751644,
  9784313752290,
  9784313752306,
  9784313752344,
  9784313752351,
  9784313752504,
  9784313752535,
  9784313752573,
  9784313752627,
  9784313752672,
  9784313752702,
  9784313752719,
  9784313752740,
  9784313860018,
  9784313860216,
  9784313860223,
  9784313150812,
  9784313652620,
  9784313150805,
  9784313652699,
  9784313652729,
  9784313652781,
  9784313150829,
  9784313150836,
  9784313652927,
  9784313660632,
  9784313652767,
  9784313121126,
  9784313205352,
  9784313653146,
  9784313653139,
  9784313205369,
  9784313511606,
  9784313653177,
  9784313653153,
  9784313653160,
  9784313652651,
  9784313180505,
  9784313653191,
  9784313180512,
  9784313810921,
  9784313653207,
  9784313180543,
  9784313205376,
  9784313313989,
  9784313653245,
  9784313166202,
  9784313653108,
  9784313653252,
  9784313313996,
  9784313653115,
  9784313653283,
  9784313753006,
  9784313653276,
  9784313653269,
  9784313653351,
  9784313646032,
  9784313653054,
  9784313150874,
  9784313150867,
  9784313180550,
  9784313653399,
  9784313210769,
  9784313180567,
  9784313511637,
  9784313653412,
  9784313210776,
  9784313511651,
  9784313180574,
  9784313653474,
  9784313150904,
  9784313150898,
  9784313653566,
  9784313653511,
  9784313166820,
  9784313653610,
  9784313653603,
  9784313210790,
  9784313653627,
  9784313653528,
  9784313653535,
  9784313150911,
  9784313753013,
  9784313314160,
  9784313121188,
  9784313121171,
  9784313150928,
  9784313180598,
  9784313150881,
  9784313653658,
  9784313150942,
  9784313653641,
  9784313150935,
  9784313120822,
  9784313150959,
  9784313207868,
  9784313203433,
  9784313207332,
  9784313653634,
  9784313653665,
  9784313880368,
  9784313653689,
  9784313653696,
  9784313205437,
  9784313653726,
  9784313207646,
  9784313653672,
  9784313660656,
  9784313150973,
  9784313653740,
  9784313653733,
  9784313653757,
  9784313511675,
  9784313150966,
  9784313121225,
  9784313511699,
  9784313165526,
  9784313653764,
  9784313165854,
  9784313653771,
  9784313653788,
  9784313121232,
  9784313653795,
  9784313205222,
  9784313150997,
  9784313151017,
  9784313815278,
  9784313653818,
  9784313121249,
  9784313210806,
  9784313151048,
  9784313511705,
  9784313151024,
  9784313180604,
  9784313166516,
  9784313653825,
  9784313151031,
  9784313653832,
  9784313653887,
  9784313151086,
  9784313151055,
  9784313151093,
  9784313511729,
  9784313314177,
  9784313511712,
  9784313314184,
  9784313653931,
  9784313653948,
  9784313653894,
  9784313653900,
  9784313161627,
  9784313121256,
  9784313166219,
  9784313815285,
  9784313121263,
  9784313653979,
  9784313653955,
  9784313653962,
  9784313654013,
  9784313511750,
  9784313653993,
  9784313654020,
  9784313753020,
  9784313816084,
  9784313653924,
  9784313151123,
  9784313121287,
  9784313120648,
  9784313511781,
  9784313151130,
  9784313161634,
  9784313654068,
  9784313151062,
  9784313121270,
  9784313654112,
  9784313654075,
  9784313161672,
  9784313205444,
  9784313511859,
  9784313654129,
  9784313151109,
  9784313654136,
  9784313151185,
  9784313151178,
  9784313210783,
  9784313654150,
  9784313151192,
  9784313654167,
  9784313151161,
  9784313511828,
  9784313314207,
  9784313654198,
  9784313151116,
  9784313161641,
  9784313151079,
  9784313151239,
  9784313151222,
  9784313511743,
  9784313654204,
  9784313121300,
  9784313121324,
  9784313151208,
  9784313654228,
  9784313654235,
  9784313654242,
  9784313654181,
  9784313151154,
  9784313511866,
  9784313654273,
  9784313654211,
  9784313180635,
  9784313654303,
  9784313161689,
  9784313210813,
  9784313180642,
  9784313511873,
  9784313511880,
  9784313151246,
  9784313151253,
  9784313121348,
  9784313120655,
  9784313151277,
  9784313654358,
  9784313654365,
  9784313161696,
  9784313511798,
  9784313654419,
  9784313151307,
  9784313151284,
  9784313654334,
  9784313654372,
  9784313654310,
  9784313151321,
  9784313654440,
  9784313151352,
  9784313654471,
  9784313314214,
  9784313180659,
  9784313204836,
  9784313753037,
  9784313654457,
  9784313654037,
  9784313815308,
  9784313815292,
  9784313203440,
  9784313151215,
  9784313205451,
  9784313207349,
  9784313151369,
  9784313511910,
  9784313511903,
  9784313121331,
  9784313151291,
  9784313654426,
  9784313151338,
  9784313151345,
  9784313654518,
  9784313654563,
  9784313654570,
  9784313209428,
  9784313654549,
  9784313654525,
  9784313654532,
  9784313654495,
  9784313165816,
  9784313151376,
  9784313161740,
  9784313161726,
  9784313151314,
  9784313161764,
  9784313161757,
  9784313161771,
  9784313161788,
  9784313314221,
  9784313646063,
  9784313654488,
  9784313654433,
  9784313654501,
  9784313646070,
  9784313120662,
  9784313313934,
  9784313161795,
  9784313121218,
  9784313511927,
  9784313180666,
  9784313161733,
  9784313151390,
  9784313511583,
  9784313151420,
  9784313161801,
  9784313511767,
  9784313121362,
  9784313654662,
  9784313654655,
  9784313511958,
  9784313511934,
  9784313511941,
  9784313511897,
  9784313654402,
  9784313654174,
  9784313121294,
  9784313121355,
  9784313151406,
  9784313753044,
  9784313121386,
  9784313167247,
  9784313161818,
  9784313654730,
  9784313654723,
  9784313511965,
  9784313151383,
  9784313654785,
  9784313654143,
  9784313654693,
  9784313161849,
  9784313654778,
  9784313654808,
  9784313654709,
  9784313151468,
  9784313654815,
  9784313654716,
  9784313654754,
  9784313654686,
  9784313654822,
  9784313511996,
  9784313161870,
  9784313151444,
  9784313151437,
  9784313161832,
  9784313161887,
  9784313166615,
  9784313161863,
  9784313511989,
  9784313151451,


  9784313654846,
  9784313207554,
  9784313209015,
  9784313210820,
  9784313205468,
  9784313161894,
  9784313512061,
  9784313512047,
  9784313151482,
  9784313654853,
  9784313654839,
  9784313654907,
  9784313654914,
  9784313122246,
  9784313654877,
  9784313512054,
  9784313180697,
  9784313151550,
  9784313121409,
  9784313654969,
  9784313165069,
  9784313121393,
);

$publisher_id = 86; // 学陽書房 pro stg
// $publisher_id = 1125; // 竹書房 pro

$debug = true;

if($debug) {
  // STG用
  $dsn = 'pgsql:dbname=d32hupuj29g33c;host=ec2-44-206-11-200.compute-1.amazonaws.com;port=5432';
  $db = new PDO($dsn, 'rszgmnfrbqlgot', '237cbd5e1db3db80228bbf1483cd208c850e4d22bfd12c85b7e317b1cc569700');
} else {
  // 本番用
  $dsn = 'pgsql:dbname=d3uldjpkj3ctch;host=ec2-52-204-191-143.compute-1.amazonaws.com;port=5432';
  $db = new PDO($dsn, 'u79urs9of0un6s', 'p34d02ab02bf28b14e66b09bc464b4b3e75840bfa9418dba10202fbe1840f91ec');
}

ob_start();

$i = 0;
foreach ($isbnlist as $k => $v) {
  // $sql = "select id,name,isbn,publisher_id from books where isbn = '{$v}' and publisher_id = {$publisher_id};";
  // $sql = "select id,name,isbn,publisher_id from books where isbn = '{$v}' and publisher_id = {$publisher_id} and ebook_status = false;";
  $sql = "select id,name,isbn,publisher_id from books where isbn = '{$v}' and publisher_id = {$publisher_id} and ebook_status = true;";
  // $sql = "select id,name,isbn,publisher_id from books where isbn = '{$v}' and publisher_id = {$publisher_id};";
  // $sql = "select id,name,isbn,publisher_id from books where management_code = '{$v}' and publisher_id = {$publisher_id};";
  // $sql = "select id,name from authors where name = '{$v}' and publisher_id = {$publisher_id};";
  foreach ($db->query($sql) as $row) {
    echo $row['isbn'];
    echo "||"; // 後で置換用の区切り文字
    echo $row['id'];
    echo "||"; // 後で置換用の区切り文字
    echo $row['name'];
    echo "||"; // 後で置換用の区切り文字
  }

  echo "<br>";
  $i++;
  // if($i > 20) {
    // 20回まわったら ページ出力
    flush();
    ob_flush();
    $i = 0;
  // }
}
flush();
ob_flush();

ob_end_flush();

echo "end!!";
exit();
